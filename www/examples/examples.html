<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
  <title>JsEngine Playground</title>

  <!-- IMPROVE MOBILE DEVICE SUPPORT -->
  <!-- Disable pinch zoom on touch devices -->
  <meta name="viewport" content="user-scalable=1.0,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">

  <style type="text/css">
    @import "css/LoadOverlay.css";
  </style>
</head>
<body style="background-color: #444;">

<!-- The main arena - jsEngine will run inside this element -->
<div id="arena">
</div>

<!-- Load jsEngine -->
<script type="text/javascript" src="../engine.js"></script>

<!-- Start engine -->
<script type="text/javascript">
  // Create movable character by extending Sprite
  MovableCharacter = function(x, y) {
      // Call the sprite constructor to fully extend the sprite and set all sprite properties
      Engine.Views.Sprite.call(this, 'Character', x, y, 0);

      // Add step function to the current room's eachFrame'-loop
      engine.currentRoom.loops.eachFrame.attachFunction(
          this, // This object (an instance reference is needed by the engine)
          this.step // The function to call each time the loop executes
      );
  };
  MovableCharacter.prototype = Object.create(Engine.Views.Sprite.prototype);
  Engine.Helpers.Mixin.import(MovableCharacter.prototype, {
      step: function() {
          // Check that the arrow keys are down, if so, move the object by increasing or decreasing it's x and y properties
          // Left
          if (engine.keyboard.isDown(Engine.Globals.KEY_LEFT)) {
              this.x -= engine.convertSpeed(200);
          }

          // Right
          if (engine.keyboard.isDown(Engine.Globals.KEY_RIGHT)) {
              this.x += engine.convertSpeed(200);
          }

          // Up
          if (engine.keyboard.isDown(Engine.Globals.KEY_UP)) {
              this.y -= engine.convertSpeed(200);
          }

          // Down
          if (engine.keyboard.isDown(Engine.Globals.KEY_DOWN)) {
              this.y += engine.convertSpeed(200);
          }

          // Space
          if (engine.keyboard.isPressed(Engine.Globals.KEY_SPACE)) {
              // Turn the character around
              this.animate(
                  {
                      direction: this.direction + Math.PI * 2
                  },
                  {
                      duration: 2000
                  }
              );
          }
      }
  });

  // Add MovableCharactor to the ObjectCreator to make it easier to create a movable character
  Engine.ObjectCreator.prototype.MovableCharacter = function(x, y) {
    var object;
    object = new MovableCharacter(x, y);
    return this.container.addChildren(object);
  };

  // Create main game class
  Main = function () {
      // Make a global reference to the game object
      this.onLoaded();
  };
  Main.prototype.onLoaded = function() {
    var text, sprite, movable;

    // Create two views and add them to the room
    this.bgView = new Engine.Views.Container();
    this.fgView = new Engine.Views.Container();
    engine.currentRoom.addChildren(this.bgView, this.fgView);

    // TEXT EXAMPLE
    // Make a hello world text
    text = new Engine.Views.TextBlock(
        'Hello world!', // TextBlock
        50, // x-position
        50, // y-position
        200, // width
        {
            font: 'bold 24px Verdana',
            color: '#FFF'
        }
    );

    // To draw the text, add it to the bgView
    this.bgView.addChildren(text);

    // Cache the bgView to save resources (this will cache the view's objects, and stop redrawing them separately)
    //this.bgView.setDrawCache(true);

    // SPRITE EXAMPLE
    // Make a sprite object
    sprite = new Engine.Views.Sprite(
        'Rock', // Image ID (See "/themes/Example/theme.json" for an explanation of themes)
        70, // x-position
        200, // y-position
        0 // Direction (in radians)
    );

    // Add sprite to the fg view for it to be drawn
    this.fgView.addChildren(sprite);

    // ANIMATION EXAMPLE
    // Animate a rotation of the sprite
    sprite.animate(
        {
            // Animated properties (can be all numeric properties of the animated object)
            dir: Math.PI * 4 // 2 rounds in radians
        },
        {
            // Animation options
            dur: 5000 // Set the animation duration (in ms)
        }
    );

    // Now that the object is loaded, lets create an instance of the object
    movable = this.fgView.create.MovableCharacter(
        300, // x-position
        200 // y-position
    );

    // Hide loader overlay now that everything is ready
    engine.loader.hideOverlay();
  }

  // Start engine
  new Engine({
    // Set main class to load
    gameClass: Main,

    // Set themes to load
    themes: ['Example'],

    // Set arena background-color
    backgroundColor: "#000",

    // Set resolution of the game
    canvasResX:600,
    canvasResY:400
  });
</script>

</body>
</html>
